(()=>{"use strict";class t{static async geoCodeAddress(t){const e=new google.maps.Geocoder;if("object"==typeof t)return new Promise(((o,n)=>{e.geocode(t,((t,e)=>"OK"===e?o(t):n(e)))}));throw new Error("Location should be an object")}}(new class{constructor(){this.searchForm=document.querySelectorAll('[data-form="wpseo-local-store-locator"]'),this.locationDetectionButton=document.querySelector(".wpseo_use_current_location"),this.locationDetectionButtonImg=document.querySelector(".wpseo_use_current_location img"),this.defaultCountry=storeLocator.defaultCountry,this.latLng="",this.locationDetection=this.locationDetection.bind(this),this.getLatLng=this.getLatLng.bind(this),this.handleSubmitForm=this.handleSubmitForm.bind(this)}addEventListeners(){this.searchForm.forEach((t=>t.addEventListener("submit",this.handleSubmitForm))),document.addEventListener("click",this.locationDetection)}async locationDetection(e){if(e.target===this.locationDetectionButton||e.target===this.locationDetectionButtonImg){const o=this.locationDetectionButton.dataset.target,n=document.querySelector("#"+o),s=e.target.closest("form"),a=s.querySelector('[name="wpseo-sl-lat"'),r=s.querySelector('[name="wpseo-sl-lng"');try{this.latLng=await this.getLatLng(),a.value=this.latLng.lat,r.value=this.latLng.lng}catch(t){console.log(t)}if(!(this.latLng instanceof Error))try{const e=await t.geoCodeAddress({location:this.latLng});n.value=e[0].formatted_address}catch(t){console.log(t)}}}async getLatLng(){return new Promise(((t,e)=>{navigator.geolocation.getCurrentPosition((e=>t({lat:parseFloat(e.coords.latitude),lng:parseFloat(e.coords.longitude)})),(function(t){return e(new Error("Location detection unsuccesfull"))}))}))}async handleSubmitForm(e){e.preventDefault();const o=e.target.querySelector('[name="wpseo-sl-lat"'),n=e.target.querySelector('[name="wpseo-sl-lng"'),s=e.target.querySelector('[name="wpseo-sl-search"');if(""===o.value||""===n.value){document.removeEventListener("submit",this.handleSubmitForm);const a=new Promise((async(e,a)=>{let r=s.value;""!==this.defaultCountry&&(r+=", "+this.defaultCountry);const i=await t.geoCodeAddress({address:r});o.value=i[0].geometry.location.lat(),n.value=i[0].geometry.location.lng(),""!==o.value&&""!==n.value&&e("success")}));"success"===await a&&e.target.submit()}else e.target.submit()}}).addEventListeners()})();