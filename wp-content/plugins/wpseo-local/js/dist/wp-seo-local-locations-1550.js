(()=>{"use strict";class e{static async geoCodeAddress(e){const t=new google.maps.Geocoder;if("object"==typeof e)return new Promise(((a,o)=>{t.geocode(e,((e,t)=>"OK"===t?a(e):o(t)))}));throw new Error("Location should be an object")}}class t{static async getTimezone(e,t){const a=Math.floor(Date.now()/1e3),o=new URLSearchParams;o.append("location",e),o.append("timestamp",a),o.append("key",t);const i="https://maps.googleapis.com/maps/api/timezone/json?"+o;return new Promise(((e,t)=>{const a=new XMLHttpRequest;a.open("GET",i),a.onload=()=>{if(200===a.status){const o=JSON.parse(a.responseText);return"OK"===o.status?e(o.timeZoneId):t(o)}return t(a.status)},a.send()}))}}(new class{constructor(){this.addressFields=[document.querySelector(".wpseo_local_address_input"),document.querySelector(".wpseo_local_zipcode_input"),document.querySelector(".wpseo_local_city_input"),document.querySelector(".wpseo_local_state_input"),document.querySelector('.select[id*="_country"]')],this.latLngSettingsContainer=document.getElementById("location-coordinates-settings-wrapper"),this.latLngSettingsFieldWrapper=document.getElementById("location-coordinates-settings-lat-lng-wrapper"),this.calculateLatLngButton=document.getElementById("calculate_lat_lng_button"),this.latField=document.querySelector(".wpseo_local_lat_input"),this.lngField=document.querySelector(".wpseo_local_lng_input"),this.timezoneField=document.querySelector('select[id*="_timezone"]'),this.apiKey=wpseoLocalLocations.apiKey,this.maybeGeoCodeAddress=this.maybeGeoCodeAddress.bind(this),this.maybeShowAddressChangesNotification=this.maybeShowAddressChangesNotification.bind(this),this.setTimezone=this.setTimezone.bind(this),this.formatAddress=this.formatAddress.bind(this)}addEventListeners(){document.addEventListener("click",this.maybeGeoCodeAddress),document.addEventListener("change",this.maybeShowAddressChangesNotification)}async maybeGeoCodeAddress(t){if(null!==this.latField&&null!==this.lngField&&(this.calculateLatLngNotification=document.querySelector(".yoast-seo-local__alert.location-calculate-alert"),this.calculateLatLngButton===t.target)){t.preventDefault(),this.errorField=document.querySelector(".wpseo_local_geocoding_error");const a=this.latField.value,o=this.lngField.value,i=this.formatAddress();null!==this.errorField&&this.errorField.parentNode.removeChild(this.errorField),this.latField.value="",this.lngField.value="";const s=document.createElement("div");try{const t=await e.geoCodeAddress({address:i});this.latField.value=t[0].geometry.location.lat(),this.lngField.value=t[0].geometry.location.lng(),null!==this.calculateLatLngNotification&&this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification),s.innerHTML=wpseoLocalLocations.calculateLatLngSuccessMessage,this.latLngSettingsContainer.insertBefore(s,this.latLngSettingsFieldWrapper),(""!==this.latField.value&&""!==this.lngField.value&&this.latField.value!==a||this.lngField.value!==o)&&this.setTimezone()}catch(e){const t=document.createElement("p");switch(t.classList.add("wpseo_local_geocoding_error"),null!==this.calculateLatLngNotification&&this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification),s.innerHTML=wpseoLocalLocations.calculateLatLngErrorMessage,this.latLngSettingsContainer.insertBefore(s,this.latLngSettingsFieldWrapper),e){case"ZERO_RESULTS":t.appendChild(document.createTextNode("We could not retrieve coordinates for this address."));break;case"OVER_QUERY_LIMIT":t.appendChild(document.createTextNode("You are over your query limit."));break;case"REQUEST_DENIED":t.appendChild(document.createTextNode("Your API key is not entered or not valid."))}}}}async maybeShowAddressChangesNotification(e){if(-1!==this.addressFields.indexOf(e.target)){this.calculateLatLngNotification=document.querySelector(".yoast-seo-local__alert.location-calculate-alert"),null!==this.calculateLatLngNotification&&this.calculateLatLngNotification.parentNode.removeChild(this.calculateLatLngNotification);const e=document.createElement("div");e.innerHTML=wpseoLocalLocations.addressChangedMessage,this.latLngSettingsContainer.insertBefore(e,this.latLngSettingsFieldWrapper)}}formatAddress(){let e=[];return this.addressFields.forEach((function(t){""!==t.value&&e.push(t.value)})),e.join(", ")}async setTimezone(){const e=this.latField.value+", "+this.lngField.value;try{const a=await t.getTimezone(e,this.apiKey);""!==a&&jQuery(this.timezoneField).val(a).trigger("change")}catch(e){console.log(e)}}}).addEventListeners()})();